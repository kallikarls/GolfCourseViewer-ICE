<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Golf Course GeoJSON Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    #sidebar {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 10px;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <label for="courseSelect">Select course:</label>
    <select id="courseSelect"></select>
    <br /><br />
    <label>Toggle layers:</label><br />
    <div id="layerToggles"></div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([64.13, -21.9], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    const courseSelect = document.getElementById('courseSelect');
    const layerToggles = document.getElementById('layerToggles');

    const layerGroups = {};
    const courseBounds = {};

    fetch('FeatureCollection.geojson')
      .then(response => response.json())
      .then(data => {
        const features = data.features;

        const courses = [...new Set(features.map(f => f.properties.course))].sort();
        const layers = [...new Set(features.map(f => f.properties.layer))].sort();

        courses.forEach(course => {
          const opt = document.createElement('option');
          opt.value = course;
          opt.textContent = course;
          courseSelect.appendChild(opt);
        });

        layers.forEach(layer => {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = true;
          checkbox.value = layer;
          checkbox.id = `layer_${layer}`;
          checkbox.addEventListener('change', updateLayerVisibility);
          const label = document.createElement('label');
          label.textContent = layer;
          label.htmlFor = checkbox.id;
          layerToggles.appendChild(checkbox);
          layerToggles.appendChild(label);
          layerToggles.appendChild(document.createElement('br'));
        });

        features.forEach(feature => {
          const layerName = feature.properties.layer;
          const courseName = feature.properties.course;
          const geoJson = L.geoJSON(feature);

          if (!layerGroups[courseName]) layerGroups[courseName] = {};
          if (!layerGroups[courseName][layerName]) layerGroups[courseName][layerName] = L.layerGroup();

          geoJson.addTo(layerGroups[courseName][layerName]);

          if (!courseBounds[courseName]) courseBounds[courseName] = geoJson.getBounds();
          else courseBounds[courseName].extend(geoJson.getBounds());
        });

        courseSelect.addEventListener('change', () => {
          updateMap();
        });

        updateMap();

        function updateMap() {
          const selectedCourse = courseSelect.value;
          Object.values(layerGroups).forEach(course => Object.values(course).forEach(layer => map.removeLayer(layer)));

          if (selectedCourse && layerGroups[selectedCourse]) {
            Object.entries(layerGroups[selectedCourse]).forEach(([layerName, layerGroup]) => {
              const checkbox = document.getElementById(`layer_${layerName}`);
              if (checkbox && checkbox.checked) {
                layerGroup.addTo(map);
              }
            });

            if (courseBounds[selectedCourse]) {
              map.fitBounds(courseBounds[selectedCourse]);
            }
          }
        }

        function updateLayerVisibility() {
          updateMap();
        }
      });
  </script>
</body>
</html>
